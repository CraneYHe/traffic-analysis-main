# 图表功能说明

## 已完成的图表功能

DataAnalysisView 组件现在包含完整的 ECharts 可视化功能。

### 图表特性

#### 1. **多城市数据展示**
- 每个城市显示为一条独立的折线
- 自动从API响应中提取所有城市数据
- 平滑曲线显示，符号大小为4px

#### 2. **异常数据标记**
- **缺失值**：橙色圆形标记 (#faad14)
  - 符号大小：10px
  - 白色边框，宽度2px
  - zlevel: 2（置于顶层）
  
- **异常值**：红色菱形标记 (#ff4d4f)
  - 符号大小：12px
  - 白色边框，宽度2px
  - zlevel: 2（置于顶层）

#### 3. **交互功能**

**工具栏**（右上角）：
- 💾 保存为图片（2倍像素率）
- 🔄 还原视图
- 📊 数据视图
- 📈 切换图表类型（折线图/柱状图）

**缩放功能**：
- 鼠标滚轮缩放
- 拖拽平移
- 底部滑块控制显示范围
- 内置缩放（start: 0, end: 100）

**Tooltip**：
- 鼠标悬停显示详细信息
- 十字准星跟踪
- 显示时间戳和所有系列的数值
- 数值保留两位小数

**图例**：
- 顶部滚动图例
- 点击图例显示/隐藏对应系列
- 分页控制（蓝色图标）

#### 4. **坐标轴优化**

**X轴（时间轴）**：
- 45度旋转标签
- 格式：`MM-DD HH:mm`
- 自动解析日期字符串

**Y轴（流量）**：
- 自动格式化大数值（>10000显示为"万"）
- 虚线分隔线
- 显示"流量"标签

#### 5. **视觉设计**
- 标题：18px 粗体居中
- 网格留白：左3%，右4%，底15%，顶80px
- 最小高度：600px
- 响应式布局

### 使用示例

```typescript
// API 返回的数据格式
{
  status: "success",
  message: "ok",
  data: {
    points: {
      "BANDE NERE": {
        x: ["2013-11-01 00:00:00", ...],
        y: [13723.73, 13269.43, ...],
        missing: [],      // 缺失值索引数组
        outliers: [5, 12] // 异常值索引数组
      },
      "BRERA": {
        x: ["2013-11-01 00:00:00", ...],
        y: [23797.90, 22470.30, ...],
        missing: [3],
        outliers: []
      }
    },
    stats: {
      "BANDE NERE": {
        mean: 10380.74,
        std: 2647.73,
        total: 73,
        missing: 0,
        outlier: 2
      },
      "BRERA": {
        mean: 15359.76,
        std: 4548.75,
        total: 73,
        missing: 1,
        outlier: 0
      }
    }
  }
}
```

### 图表效果预览

1. **折线图**：展示各城市的流量趋势
2. **散点标记**：突出显示问题数据点
3. **统计卡片**：左侧面板显示每个城市的统计摘要
4. **交互操作**：缩放、平移、切换显示

### 颜色方案

- 折线：自动配色（ECharts 默认主题）
- 缺失值：#faad14（橙色）
- 异常值：#ff4d4f（红色）
- 边框：#fff（白色）
- 坐标轴：#999（灰色）
- 主题色：#1890ff（蓝色）

### 性能优化

- `notMerge={true}`：完全替换而非合并配置
- `lazyUpdate={true}`：延迟更新，提升性能
- 数据缩放默认显示全部数据（0-100%）
- 符号大小适中，避免渲染压力

### 后续扩展建议

1. 添加数据导出功能（CSV/Excel）
2. 支持时间范围快捷选择
3. 添加更多图表类型（面积图、堆叠图）
4. 实时数据更新
5. 多图表对比视图
